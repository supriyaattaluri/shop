var express = require('express');
var router = express.Router();
var mongoose = require('mongoose');
var passport = require('passport');
var user = mongoose.model('User');

router.post('/', function(req, res) 
{

user.findOne({ 'email': req.body.email , 'password':req.body.password }, function(err, userobj) {
                 
						
                    // In case of any error, return using the done method
                    if (err){
                        console.log('Error in password change: '+err);
                        return done(err);
                    	}
                    // if mailid exists
                    if (userobj) {
                    console.log("i am inside");
			                        var newUser = new User();

			                        // set the user's updated credentials
			                        newUser.newpassword = newpassword;
			                        newUser.retypepassword = retypepassword;

			           		   		if(newUser.newpassword === newUser.retypepassword)
			                  		   {

				                  			newUser.update(
						                  			{ _id: userobj.id},
							                  			{ $set: { password : newUser.newpassword} },function(err, result) {
													            if (err) {
													                console.log(err.stack);
													            }
													            res.json({message: 'user updated!'});
												        });       
										}
										else
										{
										res.json({"msg":"retype password doesnot match with password"}); 
									    }
											        
								}			 
                    			
                })
 });


module.exports = router;

